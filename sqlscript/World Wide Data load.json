{
	"name": "World Wide Data load",
	"properties": {
		"content": {
			"query": "/* **************************************************************************************\n* Setup loads world wide sample dataset\n* source: https://learn.microsoft.com/en-us/azure/synapse-analytics/sql-data-warehouse/load-data-wideworldimportersdw\n************************************************************************************** */\n\nCREATE LOGIN LoaderRC60 WITH PASSWORD = 'CHANGEME';\nCREATE USER LoaderRC60 FOR LOGIN LoaderRC60;\n\n\nGRANT CONTROL ON DATABASE::[SampleDW] to LoaderRC60;\nEXEC sp_addrolemember 'staticrc60', 'LoaderRC60';\n\n\nCREATE MASTER KEY;\n\n\nCREATE EXTERNAL DATA SOURCE WWIStorage\nWITH\n(\n    TYPE = Hadoop,\n    LOCATION = 'wasbs://wideworldimporters@sqldwholdata.blob.core.windows.net'\n);\ngo\n\n\nCREATE EXTERNAL FILE FORMAT TextFileFormat\nWITH\n(\n    FORMAT_TYPE = DELIMITEDTEXT,\n    FORMAT_OPTIONS\n    (\n        FIELD_TERMINATOR = '|',\n        USE_TYPE_DEFAULT = FALSE\n    )\n);\n\n\nCREATE SCHEMA ext;\nGO\nCREATE SCHEMA wwi;\n\n/* **************************************************************************************\n* Create external tables\n************************************************************************************** */\n\nCREATE EXTERNAL TABLE [ext].[dimension_City](\n    [City Key] [int] NOT NULL,\n    [WWI City ID] [int] NOT NULL,\n    [City] [nvarchar](50) NOT NULL,\n    [State Province] [nvarchar](50) NOT NULL,\n    [Country] [nvarchar](60) NOT NULL,\n    [Continent] [nvarchar](30) NOT NULL,\n    [Sales Territory] [nvarchar](50) NOT NULL,\n    [Region] [nvarchar](30) NOT NULL,\n    [Subregion] [nvarchar](30) NOT NULL,\n    [Location] [nvarchar](76) NULL,\n    [Latest Recorded Population] [bigint] NOT NULL,\n    [Valid From] [datetime2](7) NOT NULL,\n    [Valid To] [datetime2](7) NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH (LOCATION='/v1/dimension_City/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);  \nCREATE EXTERNAL TABLE [ext].[dimension_Customer] (\n    [Customer Key] [int] NOT NULL,\n    [WWI Customer ID] [int] NOT NULL,\n    [Customer] [nvarchar](100) NOT NULL,\n    [Bill To Customer] [nvarchar](100) NOT NULL,\n       [Category] [nvarchar](50) NOT NULL,\n    [Buying Group] [nvarchar](50) NOT NULL,\n    [Primary Contact] [nvarchar](50) NOT NULL,\n    [Postal Code] [nvarchar](10) NOT NULL,\n    [Valid From] [datetime2](7) NOT NULL,\n    [Valid To] [datetime2](7) NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH (LOCATION='/v1/dimension_Customer/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);  \nCREATE EXTERNAL TABLE [ext].[dimension_Employee] (\n    [Employee Key] [int] NOT NULL,\n    [WWI Employee ID] [int] NOT NULL,\n    [Employee] [nvarchar](50) NOT NULL,\n    [Preferred Name] [nvarchar](50) NOT NULL,\n    [Is Salesperson] [bit] NOT NULL,\n    [Photo] [varbinary](300) NULL,\n    [Valid From] [datetime2](7) NOT NULL,\n    [Valid To] [datetime2](7) NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION='/v1/dimension_Employee/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\nCREATE EXTERNAL TABLE [ext].[dimension_PaymentMethod] (\n    [Payment Method Key] [int] NOT NULL,\n    [WWI Payment Method ID] [int] NOT NULL,\n    [Payment Method] [nvarchar](50) NOT NULL,\n    [Valid From] [datetime2](7) NOT NULL,\n    [Valid To] [datetime2](7) NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/dimension_PaymentMethod/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\nCREATE EXTERNAL TABLE [ext].[dimension_StockItem](\n    [Stock Item Key] [int] NOT NULL,\n    [WWI Stock Item ID] [int] NOT NULL,\n    [Stock Item] [nvarchar](100) NOT NULL,\n    [Color] [nvarchar](20) NOT NULL,\n    [Selling Package] [nvarchar](50) NOT NULL,\n    [Buying Package] [nvarchar](50) NOT NULL,\n    [Brand] [nvarchar](50) NOT NULL,\n    [Size] [nvarchar](20) NOT NULL,\n    [Lead Time Days] [int] NOT NULL,\n    [Quantity Per Outer] [int] NOT NULL,\n    [Is Chiller Stock] [bit] NOT NULL,\n    [Barcode] [nvarchar](50) NULL,\n    [Tax Rate] [decimal](18, 3) NOT NULL,\n    [Unit Price] [decimal](18, 2) NOT NULL,\n    [Recommended Retail Price] [decimal](18, 2) NULL,\n    [Typical Weight Per Unit] [decimal](18, 3) NOT NULL,\n    [Photo] [varbinary](300) NULL,\n    [Valid From] [datetime2](7) NOT NULL,\n    [Valid To] [datetime2](7) NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/dimension_StockItem/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\nCREATE EXTERNAL TABLE [ext].[dimension_Supplier](\n    [Supplier Key] [int] NOT NULL,\n    [WWI Supplier ID] [int] NOT NULL,\n    [Supplier] [nvarchar](100) NOT NULL,\n    [Category] [nvarchar](50) NOT NULL,\n    [Primary Contact] [nvarchar](50) NOT NULL,\n    [Supplier Reference] [nvarchar](20) NULL,\n    [Payment Days] [int] NOT NULL,\n    [Postal Code] [nvarchar](10) NOT NULL,\n    [Valid From] [datetime2](7) NOT NULL,\n    [Valid To] [datetime2](7) NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/dimension_Supplier/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\nCREATE EXTERNAL TABLE [ext].[dimension_TransactionType](\n    [Transaction Type Key] [int] NOT NULL,\n    [WWI Transaction Type ID] [int] NOT NULL,\n    [Transaction Type] [nvarchar](50) NOT NULL,\n    [Valid From] [datetime2](7) NOT NULL,\n    [Valid To] [datetime2](7) NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/dimension_TransactionType/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\nCREATE EXTERNAL TABLE [ext].[fact_Movement] (\n    [Movement Key] [bigint] NOT NULL,\n    [Date Key] [date] NOT NULL,\n    [Stock Item Key] [int] NOT NULL,\n    [Customer Key] [int] NULL,\n    [Supplier Key] [int] NULL,\n    [Transaction Type Key] [int] NOT NULL,\n    [WWI Stock Item Transaction ID] [int] NOT NULL,\n    [WWI Invoice ID] [int] NULL,\n    [WWI Purchase Order ID] [int] NULL,\n    [Quantity] [int] NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/fact_Movement/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\nCREATE EXTERNAL TABLE [ext].[fact_Order] (\n    [Order Key] [bigint] NOT NULL,\n    [City Key] [int] NOT NULL,\n    [Customer Key] [int] NOT NULL,\n    [Stock Item Key] [int] NOT NULL,\n    [Order Date Key] [date] NOT NULL,\n    [Picked Date Key] [date] NULL,\n    [Salesperson Key] [int] NOT NULL,\n    [Picker Key] [int] NULL,\n    [WWI Order ID] [int] NOT NULL,\n    [WWI Backorder ID] [int] NULL,\n    [Description] [nvarchar](100) NOT NULL,\n    [Package] [nvarchar](50) NOT NULL,\n    [Quantity] [int] NOT NULL,\n    [Unit Price] [decimal](18, 2) NOT NULL,\n    [Tax Rate] [decimal](18, 3) NOT NULL,\n    [Total Excluding Tax] [decimal](18, 2) NOT NULL,\n    [Tax Amount] [decimal](18, 2) NOT NULL,\n    [Total Including Tax] [decimal](18, 2) NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/fact_Order/',\n    DATA_SOURCE = WWIStorage,\n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\nCREATE EXTERNAL TABLE [ext].[fact_Purchase] (\n    [Purchase Key] [bigint] NOT NULL,\n    [Date Key] [date] NOT NULL,\n    [Supplier Key] [int] NOT NULL,\n    [Stock Item Key] [int] NOT NULL,\n    [WWI Purchase Order ID] [int] NULL,\n    [Ordered Outers] [int] NOT NULL,\n    [Ordered Quantity] [int] NOT NULL,\n    [Received Outers] [int] NOT NULL,\n    [Package] [nvarchar](50) NOT NULL,\n    [Is Order Finalized] [bit] NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/fact_Purchase/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\nCREATE EXTERNAL TABLE [ext].[fact_Sale] (\n    [Sale Key] [bigint] NOT NULL,\n    [City Key] [int] NOT NULL,\n    [Customer Key] [int] NOT NULL,\n    [Bill To Customer Key] [int] NOT NULL,\n    [Stock Item Key] [int] NOT NULL,\n    [Invoice Date Key] [date] NOT NULL,\n    [Delivery Date Key] [date] NULL,\n    [Salesperson Key] [int] NOT NULL,\n    [WWI Invoice ID] [int] NOT NULL,\n    [Description] [nvarchar](100) NOT NULL,\n    [Package] [nvarchar](50) NOT NULL,\n    [Quantity] [int] NOT NULL,\n    [Unit Price] [decimal](18, 2) NOT NULL,\n    [Tax Rate] [decimal](18, 3) NOT NULL,\n    [Total Excluding Tax] [decimal](18, 2) NOT NULL,\n    [Tax Amount] [decimal](18, 2) NOT NULL,\n    [Profit] [decimal](18, 2) NOT NULL,\n    [Total Including Tax] [decimal](18, 2) NOT NULL,\n    [Total Dry Items] [int] NOT NULL,\n    [Total Chiller Items] [int] NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/fact_Sale/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\nCREATE EXTERNAL TABLE [ext].[fact_StockHolding] (\n    [Stock Holding Key] [bigint] NOT NULL,\n    [Stock Item Key] [int] NOT NULL,\n    [Quantity On Hand] [int] NOT NULL,\n    [Bin Location] [nvarchar](20) NOT NULL,\n    [Last Stocktake Quantity] [int] NOT NULL,\n    [Last Cost Price] [decimal](18, 2) NOT NULL,\n    [Reorder Level] [int] NOT NULL,\n    [Target Stock Level] [int] NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/fact_StockHolding/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\nCREATE EXTERNAL TABLE [ext].[fact_Transaction] (\n    [Transaction Key] [bigint] NOT NULL,\n    [Date Key] [date] NOT NULL,\n    [Customer Key] [int] NULL,\n    [Bill To Customer Key] [int] NULL,\n    [Supplier Key] [int] NULL,\n    [Transaction Type Key] [int] NOT NULL,\n    [Payment Method Key] [int] NULL,\n    [WWI Customer Transaction ID] [int] NULL,\n    [WWI Supplier Transaction ID] [int] NULL,\n    [WWI Invoice ID] [int] NULL,\n    [WWI Purchase Order ID] [int] NULL,\n    [Supplier Invoice Number] [nvarchar](20) NULL,\n    [Total Excluding Tax] [decimal](18, 2) NOT NULL,\n    [Tax Amount] [decimal](18, 2) NOT NULL,\n    [Total Including Tax] [decimal](18, 2) NOT NULL,\n    [Outstanding Balance] [decimal](18, 2) NOT NULL,\n    [Is Finalized] [bit] NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/fact_Transaction/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\n\n\n/* **************************************************************************************\n* Load the data into SQL pool\n\nThis tutorial loads the data directly into the final table. In a production environment, \nyou will usually use CREATE TABLE AS SELECT to load into a staging table. While data is in\n the staging table you can perform any necessary transformations. To append the data in the \n staging table to a production table, you can use the INSERT...SELECT statement.\n\n************************************************************************************** */\n\n\nCREATE TABLE [wwi].[dimension_City]\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[dimension_City]\nOPTION (LABEL = 'CTAS : Load [wwi].[dimension_City]')\n;\n\nCREATE TABLE [wwi].[dimension_Customer]\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[dimension_Customer]\nOPTION (LABEL = 'CTAS : Load [wwi].[dimension_Customer]')\n;\n\nCREATE TABLE [wwi].[dimension_Employee]\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[dimension_Employee]\nOPTION (LABEL = 'CTAS : Load [wwi].[dimension_Employee]')\n;\n\nCREATE TABLE [wwi].[dimension_PaymentMethod]\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[dimension_PaymentMethod]\nOPTION (LABEL = 'CTAS : Load [wwi].[dimension_PaymentMethod]')\n;\n\nCREATE TABLE [wwi].[dimension_StockItem]\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[dimension_StockItem]\nOPTION (LABEL = 'CTAS : Load [wwi].[dimension_StockItem]')\n;\n\nCREATE TABLE [wwi].[dimension_Supplier]\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[dimension_Supplier]\nOPTION (LABEL = 'CTAS : Load [wwi].[dimension_Supplier]')\n;\n\nCREATE TABLE [wwi].[dimension_TransactionType]\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[dimension_TransactionType]\nOPTION (LABEL = 'CTAS : Load [wwi].[dimension_TransactionType]')\n;\n\nCREATE TABLE [wwi].[fact_Movement]\nWITH\n(\n    DISTRIBUTION = HASH([Movement Key]),\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[fact_Movement]\nOPTION (LABEL = 'CTAS : Load [wwi].[fact_Movement]')\n;\n\nCREATE TABLE [wwi].[fact_Order]\nWITH\n(\n    DISTRIBUTION = HASH([Order Key]),\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[fact_Order]\nOPTION (LABEL = 'CTAS : Load [wwi].[fact_Order]')\n;\n\nCREATE TABLE [wwi].[fact_Purchase]\nWITH\n(\n    DISTRIBUTION = HASH([Purchase Key]),\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[fact_Purchase]\nOPTION (LABEL = 'CTAS : Load [wwi].[fact_Purchase]')\n;\n\nCREATE TABLE [wwi].[seed_Sale]\nWITH\n(\n    DISTRIBUTION = HASH([WWI Invoice ID]),\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[fact_Sale]\nOPTION (LABEL = 'CTAS : Load [wwi].[seed_Sale]')\n;\n\nCREATE TABLE [wwi].[fact_StockHolding]\nWITH\n(\n    DISTRIBUTION = HASH([Stock Holding Key]),\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[fact_StockHolding]\nOPTION (LABEL = 'CTAS : Load [wwi].[fact_StockHolding]')\n;\n\nCREATE TABLE [wwi].[fact_Transaction]\nWITH\n(\n    DISTRIBUTION = HASH([Transaction Key]),\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[fact_Transaction]\nOPTION (LABEL = 'CTAS : Load [wwi].[fact_Transaction]')\n;",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "SampleDW",
				"poolName": "SampleDW"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}